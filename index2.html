
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <title>Leaflet + WFS (GeoJSON)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  https://unpkg.com/leaflet@1.9.4/dist/leaflet.css
  https://unpkg.com/leaflet@1.9.4/dist/leaflet.js</script>
  <style>html,body,#map{height:100%;margin:0}</style>
</head>
<body>
<div id="map"></div>
<script>
const map = L.map('map').setView([-22.905, -47.060], 12);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '© OpenStreetMap'
}).addTo(map);

// URL WFS 2.0.0 -> GeoJSON (ajuste se necessário para 1.1.0)
const wfsUrl = "https://wms2-desenv.campinas.sp.gov.br/cgi-bin/mapserv" +
  "?map=/srv/www/sistemas-seplan/wms2.campinas.sp.gov.br/html/map_files/wfs_seclimas_geojson.map" +
  "&SERVICE=WFS&VERSION=2.0.0&REQUEST=GetFeature&typeNames=ms:nascentes" +
  "&outputFormat=application/json&srsName=EPSG:4326";

fetch(wfsUrl)
  .then(r => {
    if (!r.ok) throw new Error(`HTTP ${r.status}`);
    return r.json();
  })
  .then(geojson => {
    const layer = L.geoJSON(geojson, {
      pointToLayer: (f, latlng) =>
        L.circleMarker(latlng, {radius: 5, color: '#b30000', fillColor:'#ff5252', fillOpacity:0.7}),
      onEachFeature: (f, layer) => {
        if (f.properties) {
          const rows = Object.entries(f.properties)
            .map(([k,v])=>`<tr><th style="text-align:left;padding-right:8px">${k}</th><td>${v}</td></tr>`).join('');
          layer.bindPopup(`<table>${rows}</table>`);
        }
      }
    }).addTo(map);

    // centraliza nos dados (se houver)
    try {
      const b = layer.getBounds();
      if (b.isValid()) map.fitBounds(b.pad(0.08));
    } catch(e) {}
  })
  .catch(err => {
    console.error("Falha ao carregar GeoJSON do WFS:", err);
    alert("Erro ao carregar o WFS (ver console). Pode ser CORS.");
  });
</script>
</body>
</html>
